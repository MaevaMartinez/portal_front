<div class="form-container">
  <mat-spinner *ngIf="!isLoaded"></mat-spinner>
  <form [formGroup]="toolForm" *ngIf="isLoaded">
    <h4 class="perfilr">Herramientas y Tecnologías</h4>
    <div class="row mt-3">
      <div class="col-12 col-md-6 col-lg-4 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Categoría</mat-label>
          <mat-select id="categoria" formControlName="categoryId" (selectionChange)="getProducts()" class="w-100">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option value="1">Sistemas Operativos</mat-option>
            <mat-option value="2">Base de Datos</mat-option>
            <mat-option value="3">Lenguajes de programación</mat-option>
            <mat-option value="4">BigData / Cloud</mat-option>
            <mat-option value="5">Office</mat-option>
            <mat-option value="6">Business Intelligence</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-6 col-lg-4 mb-3" formGroupName="product">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Producto</mat-label>
          <mat-select id="producto" formControlName="id" (selectionChange)="getVersions()" class="w-100">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option *ngFor="let product of productsToDisplay" [value]="product.id">{{ product.name }}</mat-option>
            <mat-option value="0">Otro</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="toolForm.get('product')?.get('id')?.value === '0'" appearance="outline"
          class="mt-3 w-100">
          <mat-label>Escribe el nombre del producto</mat-label>
          <input matInput placeholder="Nombre del producto" formControlName="name">
        </mat-form-field>
      </div>

      <div class="col-12 col-md-6 col-lg-4 mb-3" formGroupName="version">
        <mat-form-field appearance="outline" *ngIf="!(toolForm.get('product')?.get('id')?.value === 'otro')"
          class="w-100">
          <mat-label>Versión Utilizada</mat-label>
          <mat-select id="version" formControlName="id" class="w-100">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option *ngFor="let version of versionsToDisplay" [value]="version.id">{{ version.name }}</mat-option>
            <mat-option value="0">Otro</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline"
          *ngIf="toolForm.get('version')?.get('id')?.value === '0' || toolForm.get('product')?.get('id')?.value === 'otro'"
          class="mt-3 w-100">
          <mat-label>Escribe el nombre de la versión</mat-label>
          <input matInput placeholder="Nombre de la versión" formControlName="name">
        </mat-form-field>
      </div>
      <div class="col-12 col-md-6 col-lg-4 mb-3" formGroupName="level">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Nivel</mat-label>
          <mat-select id="nivel" formControlName="id" class="w-100">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option value="1">Alto</mat-option>
            <mat-option value="2">Medio</mat-option>
            <mat-option value="3">Bajo</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-6 col-lg-4 ms-1 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Años de Experiencia</mat-label>
          <mat-select id="expLaboral" formControlName="yearsOfExperience" class="w-100">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option value="1">1</mat-option>
            <mat-option value="2">2</mat-option>
            <mat-option value="3">3</mat-option>
            <mat-option value="4">4</mat-option>
            <mat-option value="5">5</mat-option>
            <mat-option value="6">6</mat-option>
            <mat-option value="7">7</mat-option>
            <mat-option value="8">8</mat-option>
            <mat-option value="9">9</mat-option>
            <mat-option value="10">10</mat-option>
          </mat-select>
        </mat-form-field>
      </div>


      <div class="col-md-auto mt-4 mb-4">
        <button [disabled]="toolForm.invalid" mat-mini-fab class="minifab" type="button" id="addRow"
          (click)="addTool()">
          <mat-icon>library_add</mat-icon>
        </button>
      </div>
    </div>
  </form>
  <section class="tools-section">
    <div class="tool-list">
      <ng-container *ngFor="let tool of userTools">
        <div class="tool-card">
          <div class="tool-header">
            <div class="tool-title">{{ tool.productVersion.product!.name }} {{ tool.productVersion.name }}</div>
            <div class="tool-experience">{{ tool.yearsOfExperience }} año/s</div>
          </div>
          <div class="tool-description">{{ tool.level?.description }}</div>
          <div class="tool-actions">
            <button mat-raised-button class="botonprimario m-2" (click)="openCertificationDialog(tool)">Añadir
              Certificaciones</button>
            <button mat-mini-fab class="minifabdanger" (click)="deleteTool(tool.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </ng-container>
    </div>
  </section>
</div>