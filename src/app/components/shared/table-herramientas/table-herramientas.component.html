<mat-spinner class="form-container" *ngIf="!isLoaded"></mat-spinner>
<form class="form-container" [formGroup]="toolForm" *ngIf="isLoaded">
  <h4 class="perfilr">Herramientas y Tecnologías</h4>
  <div>
    <div class="row mt-3">
      <mat-form-field appearance="fill" class="col-sm-12 col-md-2 col-lg-2 ms-1">
        <mat-label>Categoría</mat-label>
        <mat-select id="categoria" formControlName="categoryId" (selectionChange)="getProducts()">
          <mat-option value="">Selecciona una opción</mat-option>
          <mat-option value="1">Sistemas Operativos</mat-option>
          <mat-option value="2">Base de Datos</mat-option>
          <mat-option value="3">Lenguajes de programación</mat-option>
          <mat-option value="4">BigData / Cloud</mat-option>
          <mat-option value="5">Office</mat-option>
          <mat-option value="6">Business Intelligence</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="col-sm-12 col-md-2 col-lg-2 ms-1" formGroupName="product">
        <mat-form-field appearance="fill">
          <mat-label>Producto</mat-label>
          <mat-select id="producto" formControlName="id" (selectionChange)="getVersions()">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option *ngFor="let product of productsToDisplay" [value]="product.id">{{ product.name }}</mat-option>
            <mat-option value="0">Otro</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field *ngIf="toolForm.get('product')?.get('id')?.value === '0'" appearance="fill" class="mt-3">
          <mat-label>Escribe el nombre del producto</mat-label>
          <input matInput placeholder="Nombre del producto" formControlName="name">
        </mat-form-field>
      </div>

      <div class="col-sm-12 col-md-2 col-lg-2" formGroupName="version">
        <mat-form-field appearance="fill" *ngIf="!(toolForm.get('product')?.get('id')?.value === 'otro')">
          <mat-label>Versión Utilizada</mat-label>
          <mat-select id="version" formControlName="id">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option *ngFor="let version of versionsToDisplay" [value]="version.id">{{ version.name }}</mat-option>
            <mat-option value="0">Otro</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill"
          *ngIf="toolForm.get('version')?.get('id')?.value === '0' || toolForm.get('product')?.get('id')?.value === 'otro'"
          class="mt-3">
          <mat-label>Escribe el nombre de la versión</mat-label>
          <input matInput placeholder="Nombre de la versión" formControlName="name">
        </mat-form-field>
      </div>


      <div class="col-sm-12 col-md-2 col-lg-2" formGroupName="level">
        <mat-form-field appearance="fill">
          <mat-label>Nivel</mat-label>
          <mat-select id="nivel" formControlName="id">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option value="1">Bajo</mat-option>
            <mat-option value="2">Medio</mat-option>
            <mat-option value="3">Alto</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-sm-12 col-md-2 col-lg-2 ms-1">
        <mat-form-field appearance="fill">
          <mat-label>Años de Experiencia</mat-label>
          <mat-select id="expLaboral" formControlName="yearsOfExperience">
            <mat-option value="">Selecciona una opción</mat-option>
            <mat-option value="1">1</mat-option>
            <mat-option value="2">2</mat-option>
            <mat-option value="3">3</mat-option>
            <mat-option value="4">4</mat-option>
            <mat-option value="5">5</mat-option>
            <mat-option value="6">6</mat-option>
            <mat-option value="7">7</mat-option>
            <mat-option value="8">8</mat-option>
            <mat-option value="9">9</mat-option>
            <mat-option value="10">10</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="row mt-4">
        <div class="col-md-auto">
          <button mat-mini-fab class="minifab" type="button" id="addRow" (click)="addTool()">
            <mat-icon>library_add</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="row mt-5">
    <div class="col-md-2 offset-md-5">
      <!-- <button mat-raised-button class="botonprimario" type="button" (click)="guardarDatos()">Guardar</button> -->
    </div>
  </div>


  <ng-container *ngFor="let tool of userTools">
    <mat-card class="tool-display">
      <mat-card-content>
        <div class="tool-info">
          <div>{{ tool.productVersion.product.name }} {{ tool.productVersion.name }}</div>
          <div>{{ tool.yearsOfExperience }} año/s</div>
          <div>{{ tool.level?.description }}</div>
        </div>
      </mat-card-content>
      <div> <button (click)="openCertificationDialog(tool)"> Añadir Certificaciones</button></div>
      <mat-card-actions>
        <button mat-mini-fab class="minifabdanger" (click)="deleteTool(tool.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </ng-container>

</form>